<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端错误基础 | 野生码农的学习笔记</title>
    <meta name="generator" content="VuePress 1.5.2">
    <link rel="icon" href="/logo.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="野生码农的学习笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    <link rel="preload" href="/assets/css/0.styles.3f949b7f.css" as="style"><link rel="preload" href="/assets/js/app.c90fca65.js" as="script"><link rel="preload" href="/assets/js/2.2e4f5e7a.js" as="script"><link rel="preload" href="/assets/js/14.919cf8bf.js" as="script"><link rel="prefetch" href="/assets/js/10.69fa5dae.js"><link rel="prefetch" href="/assets/js/11.4cd6501c.js"><link rel="prefetch" href="/assets/js/12.c8fbd087.js"><link rel="prefetch" href="/assets/js/13.136cdf8f.js"><link rel="prefetch" href="/assets/js/15.6821a2a9.js"><link rel="prefetch" href="/assets/js/16.2719af72.js"><link rel="prefetch" href="/assets/js/17.5d939285.js"><link rel="prefetch" href="/assets/js/18.0ebf4c50.js"><link rel="prefetch" href="/assets/js/19.f0932614.js"><link rel="prefetch" href="/assets/js/20.7a7b3be6.js"><link rel="prefetch" href="/assets/js/21.155c9560.js"><link rel="prefetch" href="/assets/js/22.fc46b628.js"><link rel="prefetch" href="/assets/js/23.32a0e6f1.js"><link rel="prefetch" href="/assets/js/24.6172f9d9.js"><link rel="prefetch" href="/assets/js/25.bed50b09.js"><link rel="prefetch" href="/assets/js/26.03ad0666.js"><link rel="prefetch" href="/assets/js/27.93308c63.js"><link rel="prefetch" href="/assets/js/28.7acfba1b.js"><link rel="prefetch" href="/assets/js/29.aedeabe5.js"><link rel="prefetch" href="/assets/js/3.ea6740c1.js"><link rel="prefetch" href="/assets/js/30.99efccf1.js"><link rel="prefetch" href="/assets/js/31.2c2acd5a.js"><link rel="prefetch" href="/assets/js/32.321282e5.js"><link rel="prefetch" href="/assets/js/33.5e1323c0.js"><link rel="prefetch" href="/assets/js/34.7e9ade7b.js"><link rel="prefetch" href="/assets/js/35.bb2ca4bc.js"><link rel="prefetch" href="/assets/js/36.1d482abb.js"><link rel="prefetch" href="/assets/js/37.7ba8e9e0.js"><link rel="prefetch" href="/assets/js/38.91d50257.js"><link rel="prefetch" href="/assets/js/39.6d070f4b.js"><link rel="prefetch" href="/assets/js/4.39dffbe6.js"><link rel="prefetch" href="/assets/js/40.ec6a2bf4.js"><link rel="prefetch" href="/assets/js/41.69450e5c.js"><link rel="prefetch" href="/assets/js/42.919db3af.js"><link rel="prefetch" href="/assets/js/43.98d4952e.js"><link rel="prefetch" href="/assets/js/44.c0693bc5.js"><link rel="prefetch" href="/assets/js/45.52c605d9.js"><link rel="prefetch" href="/assets/js/46.91a0c570.js"><link rel="prefetch" href="/assets/js/47.daf15cf7.js"><link rel="prefetch" href="/assets/js/48.465cff48.js"><link rel="prefetch" href="/assets/js/49.33ea86c1.js"><link rel="prefetch" href="/assets/js/5.f9638d00.js"><link rel="prefetch" href="/assets/js/50.37a2218c.js"><link rel="prefetch" href="/assets/js/51.9b804264.js"><link rel="prefetch" href="/assets/js/52.ac78cb02.js"><link rel="prefetch" href="/assets/js/53.adbf9af6.js"><link rel="prefetch" href="/assets/js/54.e1feca09.js"><link rel="prefetch" href="/assets/js/55.3388a11a.js"><link rel="prefetch" href="/assets/js/56.7ae27775.js"><link rel="prefetch" href="/assets/js/57.2de58100.js"><link rel="prefetch" href="/assets/js/6.b096fcc4.js"><link rel="prefetch" href="/assets/js/7.e2fa401f.js"><link rel="prefetch" href="/assets/js/8.4b1a636e.js"><link rel="prefetch" href="/assets/js/9.353f2a7d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3f949b7f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="野生码农的学习笔记" class="logo"> <span class="site-name can-hide">野生码农的学习笔记</span></a> <div class="links"><!----> <nav class="nav-links can-hide"><div class="nav-item"><a href="/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/frontend/" class="nav-link">
  前端
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  博客
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端错误基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/前端错误基础.html" class="active sidebar-link">前端错误基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/前端错误基础.html#前端错误的类型" class="sidebar-link">前端错误的类型</a></li><li class="sidebar-sub-header"><a href="/blog/前端错误基础.html#前端错误的防范" class="sidebar-link">前端错误的防范</a></li><li class="sidebar-sub-header"><a href="/blog/前端错误基础.html#前端错误捕获的方式" class="sidebar-link">前端错误捕获的方式</a></li><li class="sidebar-sub-header"><a href="/blog/前端错误基础.html#总结" class="sidebar-link">总结</a></li><li class="sidebar-sub-header"><a href="/blog/前端错误基础.html#参考资料" class="sidebar-link">参考资料</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>装饰器入门</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="前端错误基础"><a href="#前端错误基础" class="header-anchor">#</a> 前端错误基础</h1> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghlz7kwkccj30u014f0zr.jpg" alt=""></p> <hr> <h2 id="前端错误的类型"><a href="#前端错误的类型" class="header-anchor">#</a> 前端错误的类型</h2> <p>在日常开发中，我们可能会碰到什么类型的错误呢？归纳起来主要有以下几种：</p> <h3 id="_1-ecmascript-exceptions"><a href="#_1-ecmascript-exceptions" class="header-anchor">#</a> 1. ECMAScript exceptions</h3> <h3 id="_2-domexception-and-domerror"><a href="#_2-domexception-and-domerror" class="header-anchor">#</a> 2. DOMException and DOMError</h3> <h3 id="_3-网络静态资源加载错误"><a href="#_3-网络静态资源加载错误" class="header-anchor">#</a> 3. 网络静态资源加载错误</h3> <h3 id="_4-跨域引用script导致的script-error"><a href="#_4-跨域引用script导致的script-error" class="header-anchor">#</a> 4. 跨域引用script导致的script error</h3> <h3 id="_5-页面崩溃"><a href="#_5-页面崩溃" class="header-anchor">#</a> 5. 页面崩溃</h3> <hr> <h3 id="_1-ecmascript-exceptions-2"><a href="#_1-ecmascript-exceptions-2" class="header-anchor">#</a> 1. ECMAScript exceptions</h3> <ul><li><strong>ReferenceError</strong></li></ul> <p>这类型错误通常是访问那些<strong>未经声明或者不存在的变量</strong>时所触发的错误。比如：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghknf2g2c4j312c02mwf7.jpg" alt=""></p> <ul><li><strong>SyntaxError</strong></li></ul> <p>当我们JavaScript代码中出现语法错误的时候，就会导致这种类型的错误。比如：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghko9er56uj312i06agmp.jpg" alt=""></p> <ul><li><strong>TypeError</strong></li></ul> <p>我们在运行时看到最多的错误类型了。因为JavaScript是动态弱类型，所有变量的数据类型都出于变动中。如果，运行时期间，<strong>在不恰当的数据类型变量上执行不恰当的操作的时候</strong>，浏览器就会报这个大名鼎鼎的TypeError。</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghkosqfycfj312m098myx.jpg" alt=""></p> <ul><li><strong>RangeError</strong></li></ul> <p>当我们在初始化数组的时候，假如我们申请的长度过长的话，就会引发这种错误。也就是说，当数值超出相应范围的时候，就会触发这种错误。比如：</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghkovh1kxhj31280ie0wy.jpg" alt=""></p> <ul><li><strong>URIError</strong></li></ul> <p>在使用encodeURI()、encodeURIComponent或者decodeURI()、decodeURIComponent, 当传入的字符换的URL的格式不对的时候，就会导致URIError。比如:</p> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghkp4589orj312803s751.jpg" alt=""></p> <hr> <h3 id="_2-domexception-and-domerror-2"><a href="#_2-domexception-and-domerror-2" class="header-anchor">#</a> 2. DOMException and DOMError</h3> <p>DOMException就是我们在调用web API方法或者属性的时候所发生的错误,或者简单地说是在执行DOM操作的时候所抛出的错误。<a href="%5Bhttps://developer.mozilla.org/zh-CN/docs/Web/API/DOMError%5D(https://developer.mozilla.org/zh-CN/docs/Web/API/DOMError)">DOMError</a>不是标准规范，这里就没必要讨论它了。</p> <p>在跟音视频打交道的过程中，在不适当的时机调用web API方法的时候，往往会出现这类型的错误。比如：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token operator">&lt;</span>video id<span class="token operator">=</span><span class="token string">&quot;video&quot;</span> preload<span class="token operator">=</span><span class="token string">&quot;none&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;http://vfx.mtime.cn/Video/2019/02/04/mp4/190204084208765161.mp4&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>video<span class="token operator">&gt;</span>
</code></pre></div><p>上面代码会报一个<a href="https://developers.google.cn/web/updates/2017/06/play-request-was-interrupted?hl=en#fix" target="_blank" rel="noopener noreferrer">DOMException<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <blockquote><p>Uncaught (in promise) DOMException: play() failed because the user didn't interact with the document first.</p></blockquote> <p>又比如在错误地调用了DOM接口:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
     <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>
        <span class="token keyword">function</span> <span class="token function">ThrowDOMException</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token keyword">var</span> elem <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createAttribute</span> <span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span>button onclick<span class="token operator">=</span><span class="token string">&quot;ThrowDOMException ()&quot;</span><span class="token operator">&gt;</span>Throw a <span class="token constant">DOM</span> exception<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><p>上面的示例，浏览器会报一个<a href="http://help.dottoro.com/ljushpcx.php;" target="_blank" rel="noopener noreferrer">DOMException<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>:</p> <blockquote><p>Uncaught DOMException: Failed to execute 'createAttribute' on 'Document': The localName provided ('123') contains an invalid character.</p></blockquote> <h3 id="_3-网络静态资源加载错误-2"><a href="#_3-网络静态资源加载错误-2" class="header-anchor">#</a> 3. 网络静态资源加载错误</h3> <p>常见的网络静态资源包括 html文件，css文件，javascript文件，图片，音频，视频，iframe等等。所有的网络静态资源都有可能遇到加载错误这个问题。加载错误的原因可能是：</p> <ul><li>url写错了</li> <li>服务器根本没有这个资源</li> <li>服务器出现内部错误</li> <li>网络忙，请求超时而导致资源加载失败</li></ul> <p>不管什么原因，凡是客户端没有加载成功的，一律视为出现了加载错误。</p> <h3 id="_4-script-error"><a href="#_4-script-error" class="header-anchor">#</a> 4. script error</h3> <p>当跨域引用了另外一个域下JavaScript资源，并且这个JavaScript执出错的情况下，浏览器就会抛出这个错误。</p> <p>假如，我们在<code>another-domain.com</code>域名下有这么一个js文件:</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>b<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>在我们自己的域名<code>origin-domain.com</code>中，我们去引用这个文件:</p> <div class="language-js extra-class"><pre class="language-js"><code>

<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;http://another-domain.com/index.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

</code></pre></div><p>那么在这种场景下，浏览器就会抛出一个<code>script error</code>类型的错误。<code>script error</code>类型的错误基本上是在告诉你，你跨域引用的脚本执行出错了，但是你没有知道具体错误信息的权利。一切的一切都是因为，浏览器为了信息安全，制定了所谓的<strong>同源策略</strong>（<code>same-origin policy</code>）。</p> <h3 id="_5-page-crash"><a href="#_5-page-crash" class="header-anchor">#</a> 5. page crash</h3> <p><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ghkyfx0zovj30wc0cq765.jpg" alt=""></p> <hr> <h2 id="前端错误的防范"><a href="#前端错误的防范" class="header-anchor">#</a> 前端错误的防范</h2> <p>DOMException一般是在你对DOM API理解或者记错的情况下犯的错误。在出错前，你潜意识地就觉得自己可能是对。所以在这种情况下，是无法人为地防范的。其他的几种错误，错误源头几乎不在你的掌控范围内，所以，你也无法防范。</p> <p>接下来主要探讨一下我们该如何防范ECMAScript exceptions这种类型的错误，这是我们能人为防范的。</p> <p>其实，若引入TypeScript，为我们的JavaScript加上一层类型的保护衣后，这里面的很多错误都能够在代码编写期得到提醒和纠正。但是，这一小节还是想来谈谈，如何通过培养一些好的JavaScript编程习惯来防范这类型的错误。</p> <p>在ECMAScript exceptions这类型的错误中，我们主要防范的是以下三种子类型的错误：</p> <ul><li>隐性类型转换导致的错误</li> <li>缺乏类型防守导致的错误</li> <li>通信错误</li></ul> <h3 id="隐性类型转换导致的错误"><a href="#隐性类型转换导致的错误" class="header-anchor">#</a> <code>隐性类型转换</code>导致的错误</h3> <p>这种错误一般在对隐性类型转换不够警惕而导致的错误。</p> <p>举个例子，你手头上有一个数字类型的id，然后从后端接口请求回一个列表。如果列表中某个item的id等于你手头这个id的话，那么你就想把这个item的的边框高亮起来。这个时候你考虑到后端同事的不靠谱，有时候返回字符串类型，有时候返回数字类型，你于是这么写：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>id <span class="token operator">==</span> myID<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token operator">...</span>item<span class="token punctuation">,</span>
            iSelected<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> item<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>是的，这里为了容错性，使用了等于号所带来的<code>隐性类型转换</code>而不是全等号也算是用得其所。所以说，隐性类型转换没有错，关键是你知道怎么用。但是话说回来，隐形类型转换终究是会降低了代码的可预测性，使得代码难以维护。</p> <p><strong><code>众所周知，当使用相等(==)和不相等(!=)操作符，或者在if,for以及while等流程控制语句使用非布尔值类型的的数据的时候，实质上我们是在使用隐性类型转换</code></strong>。</p> <p>当你对隐性类型转换的警惕性稍有下降的时候，你就会犯错了。</p> <p>举个例子，在理财业务开发中，我们有个输入框，它主要是用于输入购买金额。在输入框的下面，我们会有一个提示语。实时地跟进用户的输入同步计算该购买金额所产生的利息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> hintText <span class="token operator">=</span> <span class="token string">'请输入购买金额'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> purchaseAmount <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>purchaseAmount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> income <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">.</span> <span class="token comment">// 做算术四则运算;</span>
    hintText <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">预计收益是$(income)元</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因为用户的有可能输入的是“0”，这个时候因为if语句的隐性类型转换为false，导致无法更新hintText。结果是，用户虽然是输入了东西，但是界面还是显示默认的提示语“请输入购买金额”。虽然不是一个致命的错误，但是很明显是一个不符合逻辑的错误。</p> <p>此处，如果能够避免隐性类型转换，那么我们就不会犯下这个错误：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> purchaseAmount <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isNaN</span><span class="token punctuation">(</span>purchaseAmount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ......</span>
<span class="token punctuation">}</span>
</code></pre></div><p>虽然此处的错误不会导致js代码的运行时错误，但是保不齐下次就会把不恰当的类型漏放进去到if语句的代码块中，然后基于在此类型数据做不恰当的操作，很有可能就导致一个TypeError的错误。</p> <p>所以，我们要避免使用隐性转换。怎样避免法呢？</p> <ul><li>使用全等号（===）和不全等号(!==)来代替等号(==)和不等号(!=);</li> <li>在各种流程控制语句中，做条件判断的时候要确保传入的是一个布尔值（或者值为布尔值的表达式）。</li></ul> <h3 id="缺乏类型防守导致的错误"><a href="#缺乏类型防守导致的错误" class="header-anchor">#</a> 缺乏<code>类型防守</code>导致的错误</h3> <p>JavaScript是一个动态弱类型的编程语言。所以，在使用JS进行软件开发的过程中，为了保证程序的健壮性，类型防守太重要了。</p> <p>举个例子,下面我们要实现一个从url上获取query string的函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> pos <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> url<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们理所当然地以为url是字符串类型。但是万一调用我们函数的人，一不小心传了数字类型值进来呢？显然，此处，在不恰当的数据类型上调用了不恰当的方法，浏览器会在运行时给我们一个大大的“<code>Uncaught TypeError:url.indexOf is not a function</code>”。只要我们提高警惕性，加上一条简单的类型防守的判断语句即可避免犯下这个错误：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> url <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> pos <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pos <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> url<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="通信错误"><a href="#通信错误" class="header-anchor">#</a> 通信错误</h3> <p>在前端开发的过程总，一般接触到的通信类型包括：前端与客户端的通信，前端与服务端的通信。</p> <p>在前端与客户端的通信中，一般出现得比较多的是前端传递给客户端一个未经编码的url，导致客户端解析出错。比如：</p> <div class="language-js extra-class"><pre class="language-js"><code>hdf<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>login<span class="token operator">?</span>redirect<span class="token operator">=</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>frontend<span class="token punctuation">.</span>com<span class="token operator">/</span>index<span class="token punctuation">.</span>html<span class="token operator">?</span>a<span class="token operator">=</span>b<span class="token operator">&amp;</span>c<span class="token operator">=</span>d
</code></pre></div><p>上面这个问题，我们使用encodeURIComponent()方法对“redirect”后面的字符串进行编码一下就可以解决这个问题：</p> <div class="language-js extra-class"><pre class="language-js"><code>hdf<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>login<span class="token operator">?</span>redirect<span class="token operator">=</span>https<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>F<span class="token operator">%</span><span class="token number">2</span>Ffrontend<span class="token punctuation">.</span>com<span class="token operator">%</span><span class="token number">2</span>Findex<span class="token punctuation">.</span>html<span class="token operator">%</span><span class="token number">3</span>Fa<span class="token operator">%</span><span class="token number">3</span>Db<span class="token operator">%</span><span class="token number">26</span>c<span class="token operator">%</span><span class="token number">3</span>Dd
</code></pre></div><p>而客户端那边在解析之前也需要用匹配的方法来进行解码。</p> <p>而在跟服务端通信的过程中，不少值得注意的事情。很多时候，前后端已经通过接口文档规定好数据类型和结构了，但是后端还是犯错，没有按照约定来返回数据类型和结构。</p> <p>关于数据类型,后端常常犯的错有：</p> <ul><li>数字类型与字符串类型的混淆</li> <li>null与“null”的混淆</li></ul> <p>关于数据结构，后端也常有不按照约定返回时候。比如我们约定好返回的数据结构是这样的：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    errorCode<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    msg<span class="token operator">:</span> ''<span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>结果，他给我返回的是：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    errorCode<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    data<span class="token operator">:</span> <span class="token punctuation">{</span>
        msg<span class="token operator">:</span> ''<span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>综上所述的种种情况，如果我们太过信任通信对方所返回的数据，而不进行相应的类型和字段防守的话，那么我们的JS代码极有可能在运行时报错TypeError。</p> <h2 id="前端错误捕获的方式"><a href="#前端错误捕获的方式" class="header-anchor">#</a> 前端错误捕获的方式</h2> <p>虽然，具备良好的防范意识和借助Typescript这个工具，能够把很多低级的错误扼杀在摇篮中。但是，最最坏的打算，终究是好的。出错不要紧，要紧的是要知道怎么处理。怎么处理呢？可以分为两个步骤：</p> <ul><li>第一步：捕获异常，获取错误信息</li> <li>第二步：视实际需求而做对应的处理</li></ul> <h3 id="第一步：捕获异常，获取错误信息"><a href="#第一步：捕获异常，获取错误信息" class="header-anchor">#</a> 第一步：捕获异常，获取错误信息</h3> <p>在页面中，捕获异常的技术手段无非有以下几种：</p> <ul><li>try...catch</li> <li>window.onerror</li> <li>window.addEventListener('error',()=&gt;{})</li> <li>element.onerror</li> <li>Promise Catch与window.addEventListener(&quot;unhandledrejection&quot;,()=&gt; {})</li> <li>iframe与iframe.onload</li> <li>其他</li></ul> <p>下面一一进行详细讲解。</p> <h4 id="try-catch"><a href="#try-catch" class="header-anchor">#</a> try ... catch</h4> <p>(1) 动机</p> <p>使用try...catch来捕获异常，归纳起来主要有两个动机：1）是真真正正地想对可能发生错误的代码进行异常捕获；2）想保证后面的代码继续运行</p> <p>(2) <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/try...catch" target="_blank" rel="noopener noreferrer">语法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
   try_statements
<span class="token punctuation">}</span>
<span class="token punctuation">[</span><span class="token function">catch</span> <span class="token punctuation">(</span>exception_var_1 <span class="token keyword">if</span> condition_1<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// non-standard</span>
   catch_statements_1
<span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token operator">...</span>
<span class="token punctuation">[</span><span class="token function">catch</span> <span class="token punctuation">(</span>exception_var_2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   catch_statements_2
<span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>finally <span class="token punctuation">{</span>
   finally_statements
<span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre></div><p>也就是说有以下几种组合方式：</p> <ul><li>try...catch</li> <li>try...finally</li> <li>try...catch...finally</li></ul> <p>使用try...catch的时候，语法上有以下几个注意点：</p> <ul><li>catch子句会收到一个错误对象。即使你不想使用这个错误对象，你也必须给它一个名字，否则浏览器会报一个“Uncaught SyntaxError”的错误。</li> <li>finally子句无论如何都会执行，并且优先级比return语句还要高。比如，下面这个函数会返回0，而不是2:</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">testFinally</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>(3) 处理范围</p> <p>只能捕获同步代码所产生的运行时错误，对于语法错误和异步代码所产生的错误是无能为力的。</p> <h4 id="window-onerror"><a href="#window-onerror" class="header-anchor">#</a> window.onerror</h4> <p>(1) 动机</p> <p>众所周知，很多做错误监控和上报的类库就是基于这个特性来实现的，我们期待它能处理那些try...catch不能处理的错误。</p> <p>(2) 语法</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre></div><p>历史原因，不同浏览器或者同一个浏览器的不同版本中，window.onerror事件处理函数所接收到的参数也是不同的。这里只是讨论标准规范：</p> <ul><li>message: 错误信息的字符串（string）</li> <li>source: 出错js文件的URL（string）</li> <li>lineno: 出错代码的行号（number）</li> <li>colno: 出错代码的列号（number）</li> <li>error: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" target="_blank" rel="noopener noreferrer">错误对象<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（object）</li></ul> <p>就像上面说的，因为传入onerror事件处理函数的参数除了message外，在跨浏览器上具有兼容性问题，所以，如果考虑浏览器兼容性，建议只使用message参数即可。</p> <p>这里值得提一点是，如果想要window.onerror捕获错误后，取消它的默认行为（这个默认行为就是在浏览器控制台打印出一个uncaught xxxxError ）,<code>事件处理器需要返回true</code>。这是反常识的。因为在UI事件系统中，取消默认行为一般是通过返回false来完成。</p> <p>(3) 范围</p> <p>3.1 window.onerror不能捕获语法错误</p> <p>3.2  window.onerror不能捕获异步代码的错误</p> <p>3.3  <strong>但是有一点值得注意的是，window.onerror竟然能捕获同样是异步代码的setTimeout和setInterval里面的错误</strong>：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'通过window.onerror捕获到的异常：'</span><span class="token punctuation">,</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>3.4  window.onerror 不能捕获静态资源的加载失败</p> <p>3.5  window.oneror是能捕获<strong>发生在事件处理函数里面的</strong>包括语法错误在内的异常</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
 window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message<span class="token punctuation">,</span> source<span class="token punctuation">,</span> lineno<span class="token punctuation">,</span> colno<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'通过window.onerror捕获到的异常：'</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>img id<span class="token operator">=</span><span class="token string">&quot;img&quot;</span> src<span class="token operator">=</span><span class="token string">&quot;./fake.png&quot;</span> onerror<span class="token operator">=</span><span class="token string">&quot;console.log(abc)&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>控制台会打印出：</p> <blockquote><p>通过window.onerror捕获到的异常： Uncaught ReferenceError: abc is not defined</p></blockquote> <p>看来，window.onerror并不是万能的。我们还指望它完完全全地去兜住try...catch的底，结果是它也有它捕获不了的错误。</p> <h4 id="window-addeventlistener-error-和-element-onerror"><a href="#window-addeventlistener-error-和-element-onerror" class="header-anchor">#</a> window.addEventListener('error',()=&gt;{})和 element.onerror</h4> <p>(1) 动机</p> <p>因为window.onerror不能捕获网络资源加载失败的错误，我们希望这两个技术手段能满足我们的需求。</p> <p>(2) 语法</p> <p>就像<a href="https://developer.mozilla.org/en-US/docs/Web/API/GlobalEventHandlers/onerror" target="_blank" rel="noopener noreferrer">MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>所说的:</p> <blockquote><p>When a resource (such as an <img> or<script></script></p></blockquote></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/3/2021, 2:30:17 PM</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/装饰器入门.html">
        /blog/装饰器入门.html
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c90fca65.js" defer></script><script src="/assets/js/2.2e4f5e7a.js" defer></script><script src="/assets/js/14.919cf8bf.js" defer></script>
  </body>
</html>
